package cn.com.evo.cms.web.voService;import cn.com.evo.cms.domain.entity.cms.Picture;import cn.com.evo.cms.domain.entity.cms.SourceRel;import cn.com.evo.cms.domain.enums.SourceRelTypeEnum;import cn.com.evo.cms.domain.enums.SourceTypeEnum;import cn.com.evo.cms.domain.vo.cms.SourcePictureVo;import cn.com.evo.cms.service.cms.SourceRelService;import com.alibaba.fastjson.JSONArray;import com.alibaba.fastjson.JSONObject;import com.google.common.collect.Lists;import org.dozer.Mapper;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import javax.transaction.Transactional;import java.util.List;import java.util.Map;/** * @Description: * @author: lu.xin * @create: 2018-11-12 5:24 PM **/@Service@Transactionalpublic class SourceRelVoService {    @Autowired    private SourceVoService sourceVoService;    @Autowired    private SourceRelService soureceRelService;    @Autowired    private Mapper mapper;    /**     * 保存栏目图片关系-前端异步调用     *     * @param map     * @param columnId     */    public List<SourcePictureVo> saveImagesAndColumn(Map<String, Object> map, String columnId) {        List<SourcePictureVo> sourcePictureVos = Lists.newArrayList();        List<Picture> pictures = Lists.newArrayList();        JSONArray images = (JSONArray) map.get("images");        for (int i = 0; i < images.size(); i++) {            JSONObject jo = images.getJSONObject(i);            jo.remove("createDate");            jo.remove("modifyDate");            Picture picture = mapper.map(jo, Picture.class);            pictures.add(picture);        }        List<SourceRel> sourceRels = Lists.newArrayList();        for (Picture picture : pictures) {            SourceRel entity = new SourceRel();            entity.setBusinessType(0);// 业务类型初始化            entity.setfId(columnId);            entity.setRelType(SourceRelTypeEnum.columnRel.getIndex());            entity.setSourceId(picture.getId());            entity.setSourcetype(SourceTypeEnum.image.getIndex());            soureceRelService.save(entity);            sourceRels.add(entity);        }        sourcePictureVos = sourceVoService.pictureDataHandle(sourceRels);        return sourcePictureVos;    }}